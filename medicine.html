<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            display: flex;
            font-family: Arial, sans-serif;
            margin: 0;
            font-size: 22px;
            background-color: #d3d3d3; /* 整個網頁背景為淺灰色 */
        }

        h1 {
            margin-top: 0px; /* 調整標題與上方的距離 */
            font-size: 40px; /* 調整標題字體大小 */
            color: #000000;
            background-color: #d3d3d3; /* 調整標題背景色為淺灰色 */
            padding: 0px; /* 添加標題的內邊距 */
            text-align: center; /* 標題置中 */
        }

        nav {
            background-color: #333;
            color: white;
            padding: 15px;
            width: 240px;
            height: 100vh; /* Set a fixed height using viewport height (100vh) */
        }

        nav button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 20px;
            color: white;
            background-color: #555;
            border: none;
            cursor: pointer;
        }

        nav button:hover {
            background-color: #333;
        }

        main {
            flex: 1;
            padding: 20px;
        }

        form {
            text-align: left; /* 輸入框和下拉式選單靠左對齊 */
            margin-top: 10px; /* 調整表單元素之間的間距 */
            padding: 0 0px; /* 調整表單的內邊距 */
        }

        label {
            font-size: 20px; /* 设置label元素的字体大小为20像素 */
            display: flex; /* 将label元素设为flex布局 */
            align-items: center; /* 垂直居中对齐 */
        }

        input, select {
            font-size: 20px; /* 设置输入框和下拉式選單的字体大小为20像素 */
            padding: 8px; /* 设置输入框和下拉式選單的内边距 */
            margin-left: 0; /* 調整左邊距為0 */
            width: 240px; /* 調整輸入框和下拉式選單的寬度 */
        }

        button {
            width: 200px;
            height: 80px;
            font-size: 22px;
            background-color: #808080;
            color: white;
            border: none;
            transition: background-color 0.3s;
            margin-left: 0; /* 調整左邊距為0 */
        }

        button:hover {
            background-color: #555;
        }

        table {
            width: 100%; /* 让表格宽度充满父容器 */
            table-layout: fixed; /* 固定表格布局 */
        }

        table th, table td {
            padding: 10px; /* 添加一些内边距 */
            border: 2px solid ; /* 设置边框粗细和颜色 */
        }

        th {
            text-align: left; /* 表头文本左对齐 */
        }

        td {
            text-align: left; /* 单元格文本左对齐 */
        }

    </style>
</head>
<body>

<nav>
    <button onclick="window.location.href = 'showPatientInfo.html'">病患資料建檔/Patient</button>
    <button onclick="window.location.href = 'diagnosis_info.html'">上傳病歷檔案/Upload</button>
    <button onclick="window.location.href = 'showDownload.html'">下載病歷報告/Download</button>
	<button onclick="window.location.href = 'medicine.html'">看看用藥/Download</button>
	<button onclick="window.location.href = 'showAllPatients.html'">查看病患資料</button>
</nav>

<main id="content">
    <!-- Content will change based on button clicks -->
    <h1>看看用藥</h1>
</main>

<script>
    function showmedicine() {
        document.getElementById("content").innerHTML = `
            <h1 style="text-align: center;">看看用藥</h1>
            <h2>上傳用藥</h2>
            <p id="errorOutput" style="color: red;"></p>
            <form id="medicineForm">
                <label for="name">用藥</label>
                <input type="text" id="name" placeholder="">
                <br><br>
                <button type="button" onclick="uploadMedicineData()">送出</button>
                <br><br>
                <div id="loadingSpinner" style="display: none; text-align: center;">
                    <img src="Loading_icon.gif" alt="Loading..." width="50" height="50">
                    <p>Loading...</p>
                </div>
                <div id="responseMessage"></div>
                <h2>相關資訊</h2>
                <table id="responseTable" border="1">
                    <col style="width: 11%;">
                    <col style="width: 89%;">
                    <tr><th>藥物類別</th><td id="drugClass"></td></tr>
                    <tr><th>心臟毒性警示</th><td id="cardiotoxicityWarning"></td></tr>
                    <tr><th>中文摘要</th><td id="chineseSummary"></td></tr>
                    <tr><th>原文</th><td id="originalText"></td></tr>
                </table>
            </form>`;
    }

    function uploadMedicineData() {
        document.getElementById("responseMessage").innerHTML = '';
        var Uname = document.getElementById("name").value;

        var formData = new FormData();
        formData.append('userName', Uname);

        var loadingSpinner = document.getElementById('loadingSpinner');
        loadingSpinner.style.display = 'block';

        fetch("https://e1dc-140-116-156-231.ngrok-free.app/cancer", {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('網路回應不正確');
            }

            return response.json();
        })
        .then(data => {
            // 隱藏加載中 Spinner
            loadingSpinner.style.display = 'none';
            
            // 更新表格資料
            updateTableData(data);

            // 更新回應訊息
            var message = data.message || '';
            document.getElementById("responseMessage").innerHTML = message;
        })
        .catch(error => {
            console.error('發生 fetch 操作問題:', error);
            document.getElementById('responseMessage').textContent = '上傳失敗: ' + error.message;

            // 隱藏加載中 Spinner（錯誤情況）
            loadingSpinner.style.display = 'none';
        });
    }

    function updateTableData(data) {
        document.getElementById('drugClass').innerText = data.drug_type || '';
        document.getElementById('cardiotoxicityWarning').innerText = data.cardiotoxicity || '';
        document.getElementById('chineseSummary').innerText = data.Chinese_abstract || '';
        document.getElementById('originalText').innerText = data.original_text || '';
    }

    window.onload = function() {
        showmedicine();
    };
</script>

</body>
</html>
